const translations = {
    en: {
      nav_features: "Features",
      nav_faq: "FAQ",
      nav_download: "Download",
      nav_about: "About",
      nav_menu: "Menu",
      hero_heading: "Gwenchana",
      hero_tagline: "Not just another Korean learning app",
      hero_support: "AI tutor makes understanding easier and keeps you motivated to practice every day",
      btn_appstore_pretitle: "Download on the",
      btn_appstore: "App Store",
      btn_googleplay_pretitle: "Get it on",
      btn_googleplay: "Google Play",
      features_title: "Why Gwenchana?",
      features_multi_title: "Multi-language Support",
      features_multi_desc: "Supports multiple languages with full localization.",
      features_auth_title: "Secure Authentication",
      features_auth_desc: "Log in with email, Google, or Facebook in seconds.",
      features_vocab_title: "Vocabulary Workouts",
      features_vocab_desc: "Interactive drills and flashcards keep new words fresh.",
      features_progress_title: "Progress Tracking",
      features_progress_desc: "Visualize your gains across every KIIP level.",
      features_ai_title: "AI Tutor",
      features_ai_desc: "Personalized explanations from an always-on AI coach.",
      features_offline_title: "Create Your Own Cards",
      features_offline_desc: "Add words, translations, and examples to study your way.",
      vocab_pill: "Interactive preview",
      vocab_title: "Build your vocabulary",
      vocab_body: "Tap a Korean word to reveal the translation in your language. Track your progress and enjoy learning with interactive flashcards.",
      vocab_hint_show: "Tap to reveal translation",
      vocab_hint_hide: "Tap to hide translation",
      vocab_prev: "Previous word",
      vocab_next: "Next word",
      faq_title: "FAQ",
      faq_q1: "Is Gwenchana good for beginners?",
      faq_a1: "Yes, you can start with simple words and guided practice.",
      download_title: "Download Gwenchana",
      download_subtitle: "Start your free trial today.",
      
    },
    ru: {
      nav_features: "Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸",
      nav_faq: "Ğ’Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹",
      nav_download: "Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ",
      nav_about: "Ğ Ğ½Ğ°Ñ",
      nav_menu: "ĞœĞµĞ½Ñ",
      hero_heading: "Gwenchana",
      hero_tagline: "ĞĞµ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ¾Ñ‡ĞµÑ€ĞµĞ´Ğ½Ğ¾Ğµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ¸Ğ·ÑƒÑ‡ĞµĞ½Ğ¸Ñ ĞºĞ¾Ñ€ĞµĞ¹ÑĞºĞ¾Ğ³Ğ¾",
      hero_support: "Ğ˜Ğ˜-Ñ€ĞµĞ¿ĞµÑ‚Ğ¸Ñ‚Ğ¾Ñ€ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ñ‚ÑŒ Ğ¸ Ğ¼Ğ¾Ñ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸ĞºĞ¾Ğ²Ğ°Ñ‚ÑŒÑÑ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ",
      btn_appstore_pretitle: "Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ²",
      btn_appstore: "App Store",
      btn_googleplay_pretitle: "Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ Ğ²",
      btn_googleplay: "Google Play",
      features_title: "ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Gwenchana?",
      features_multi_title: "ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… ÑĞ·Ñ‹ĞºĞ¾Ğ²",
      features_multi_desc: "Ğ›Ğ¾ĞºĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ° Ğ½Ğ° Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… ÑĞ·Ñ‹ĞºĞ°Ñ….",
      features_auth_title: "Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ°Ñ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ",
      features_auth_desc: "Ğ’Ñ…Ğ¾Ğ´ Ğ¿Ğ¾ email, Google Ğ¸Ğ»Ğ¸ Facebook Ğ·Ğ° ÑĞµĞºÑƒĞ½Ğ´Ñ‹.",
      features_vocab_title: "Ğ¢Ñ€ĞµĞ½Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ ÑĞ»Ğ¾Ğ²Ğ°Ñ€Ñ",
      features_vocab_desc: "Ğ˜Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ ÑƒĞ¿Ñ€Ğ°Ğ¶Ğ½ĞµĞ½Ğ¸Ñ Ğ¸ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸ Ğ·Ğ°ĞºÑ€ĞµĞ¿Ğ»ÑÑÑ‚ Ğ½Ğ¾Ğ²Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ°.",
      features_progress_title: "ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ°",
      features_progress_desc: "ĞĞ°Ğ³Ğ»ÑĞ´Ğ½Ğ¾ Ğ²Ğ¸Ğ´Ğ¸Ñ‚Ğµ Ñ€Ğ¾ÑÑ‚ Ğ½Ğ° ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ KIIP.",
      features_ai_title: "AI-Ñ€ĞµĞ¿ĞµÑ‚Ğ¸Ñ‚Ğ¾Ñ€",
      features_ai_desc: "ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾Ğ±ÑŠÑÑĞ½ĞµĞ½Ğ¸Ñ Ğ¾Ñ‚ Ğ½Ğ°ÑÑ‚Ğ°Ğ²Ğ½Ğ¸ĞºĞ° Ğ½Ğ° Ğ±Ğ°Ğ·Ğµ Ğ˜Ğ˜ 24/7.",
      features_offline_title: "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ğ¹Ñ‚Ğµ ÑĞ²Ğ¾Ğ¸ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ¸",
      features_offline_desc: "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹Ñ‚Ğµ ÑĞ»Ğ¾Ğ²Ğ°, Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ñ‹ Ğ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ¿Ğ¾Ğ´ Ğ²Ğ°Ñˆ ÑÑ‚Ğ¸Ğ»ÑŒ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ñ.",
      vocab_pill: "Ğ˜Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ¿Ñ€ĞµĞ²ÑŒÑ",
      vocab_title: "ĞŸÑ€Ğ¾ĞºĞ°Ñ‡Ğ°Ğ¹Ñ‚Ğµ ÑĞ»Ğ¾Ğ²Ğ°Ñ€Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ğ°Ñ",
      vocab_body: "ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ½Ğ° ĞºĞ¾Ñ€ĞµĞ¹ÑĞºĞ¾Ğµ ÑĞ»Ğ¾Ğ²Ğ¾, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑƒĞ²Ğ¸Ğ´ĞµÑ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´ Ğ½Ğ° ÑĞ²Ğ¾Ñ‘Ğ¼ ÑĞ·Ñ‹ĞºĞµ. ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ Ğ¸ ÑƒÑ‡Ğ¸Ñ‚ĞµÑÑŒ Ñ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¼Ğ¸ ĞºĞ°Ñ€Ñ‚Ğ¾Ñ‡ĞºĞ°Ğ¼Ğ¸.",
      vocab_hint_show: "ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´",
      vocab_hint_hide: "ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´",
      vocab_prev: "ĞŸÑ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞµ ÑĞ»Ğ¾Ğ²Ğ¾",
      vocab_next: "Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰ĞµĞµ ÑĞ»Ğ¾Ğ²Ğ¾",
      vocab_progress: "Ğ¡Ğ»Ğ¾Ğ²Ğ¾",
      faq_title: "Ğ§Ğ°ÑÑ‚Ğ¾ Ğ·Ğ°Ğ´Ğ°Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹",
      faq_q1: "ĞŸĞ¾Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ»Ğ¸ Gwenchana Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ğ¸Ñ‡ĞºĞ¾Ğ²?",
      faq_a1: "Ğ”Ğ°, Ğ²Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ Ñ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ñ… ÑĞ»Ğ¾Ğ² Ğ¸ Ğ¿Ğ¾ÑˆĞ°Ğ³Ğ¾Ğ²Ğ¾Ğ¹ Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸ĞºĞ¸.",
      download_title: "Ğ¡ĞºĞ°Ñ‡Ğ°Ñ‚ÑŒ Gwenchana",
      download_subtitle: "ĞĞ°Ñ‡Ğ½Ğ¸Ñ‚Ğµ Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¹ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´ ÑƒĞ¶Ğµ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ.",
      
    },
    ko: {
      nav_features: "ê¸°ëŠ¥",
      nav_faq: "ìì£¼ ë¬»ëŠ” ì§ˆë¬¸",
      nav_download: "ë‹¤ìš´ë¡œë“œ",
      nav_about: "ì†Œê°œ",
      nav_menu: "ë©”ë‰´",
      hero_heading: "Gwenchana",
      hero_tagline: "ê·¸ì € ê·¸ëŸ° í•œêµ­ì–´ í•™ìŠµ ì•±ì´ ì•„ë‹ˆì—ìš”",
      hero_support: "AI íŠœí„°ê°€ ì´í•´ë¥¼ ë•ê³  ë§¤ì¼ í•™ìŠµí•˜ë„ë¡ ë™ê¸°ë¶€ì—¬í•´ìš”",
      btn_appstore_pretitle: "App Storeì—ì„œ",
      btn_appstore: "ì•±ìŠ¤í† ì–´",
      btn_googleplay_pretitle: "Google Playì—ì„œ",
      btn_googleplay: "êµ¬ê¸€ í”Œë ˆì´",
      features_title: "ì™œ Gwenchana?",
      features_multi_title: "ë‹¤êµ­ì–´ ì§€ì›",
      features_multi_desc: "ì—¬ëŸ¬ ì–¸ì–´ë¡œ í˜„ì§€í™”ëœ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.",
      features_auth_title: "ì•ˆì „í•œ ë¡œê·¸ì¸",
      features_auth_desc: "ì´ë©”ì¼, Google, Facebookìœ¼ë¡œ ê°„í¸í•˜ê²Œ ë¡œê·¸ì¸í•˜ì„¸ìš”.",
      features_vocab_title: "ì–´íœ˜ íŠ¸ë ˆì´ë‹",
      features_vocab_desc: "ìƒí˜¸ì‘ìš© ì—°ìŠµê³¼ í”Œë˜ì‹œì¹´ë“œë¡œ ìƒˆ ë‹¨ì–´ë¥¼ íƒ„íƒ„íˆ.",
      features_progress_title: "ì§„í–‰ ìƒí™© ì¶”ì ",
      features_progress_desc: "KIIP ë‹¨ê³„ë³„ ì„±ì¥ì„ ì‹œê°ì ìœ¼ë¡œ í™•ì¸í•˜ì„¸ìš”.",
      features_ai_title: "AI íŠœí„°",
      features_ai_desc: "ì–¸ì œë“ ì§€ ê°œì¸í™”ëœ ì„¤ëª…ì„ ì œê³µí•˜ëŠ” AI ì½”ì¹˜.",
      features_offline_title: "ì§ì ‘ ë§Œë“œëŠ” ë‹¨ì–´ ì¹´ë“œ",
      features_offline_desc: "ë‹¨ì–´Â·ë²ˆì—­Â·ì˜ˆë¬¸ì„ ì¶”ê°€í•´ ë‚˜ë§Œì˜ í•™ìŠµ ì„¸íŠ¸ë¥¼ ë§Œë“œì„¸ìš”.",
      vocab_pill: "ì¸í„°ë™í‹°ë¸Œ í”„ë¦¬ë·°",
      vocab_title: "ì–´íœ˜ë¥¼ ìŒ“ì•„ê°€ìš”",
      vocab_body: "í•œêµ­ì–´ ë‹¨ì–´ë¥¼ ëˆŒëŸ¬ ì„ íƒí•œ ì–¸ì–´ë¡œ ë²ˆì—­ì„ í™•ì¸í•˜ì„¸ìš”. ì§„í–‰ ìƒí™©ì„ ë”°ë¼ê°€ë©° ì¸í„°ë™í‹°ë¸Œ í”Œë˜ì‹œì¹´ë“œë¡œ ì¦ê²ê²Œ í•™ìŠµí•˜ì„¸ìš”.",
      vocab_hint_show: "íƒ­í•˜ì—¬ ë²ˆì—­ ë³´ê¸°",
      vocab_hint_hide: "íƒ­í•˜ì—¬ ë²ˆì—­ ìˆ¨ê¸°ê¸°",
      vocab_prev: "ì´ì „ ë‹¨ì–´",
      vocab_next: "ë‹¤ìŒ ë‹¨ì–´",
      vocab_progress: "ë‹¨ì–´",
      faq_title: "FAQ",
      faq_q1: "ì´ˆë³´ìì—ê²Œë„ ì¢‹ë‚˜ìš”?",
      faq_a1: "ë„¤, ê¸°ë³¸ ë‹¨ì–´ì™€ ê°€ì´ë“œ ì—°ìŠµë¶€í„° ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
      download_title: "Gwenchana ë‹¤ìš´ë¡œë“œ",
      download_subtitle: "ì˜¤ëŠ˜ ë¬´ë£Œ ì²´í—˜ì„ ì‹œì‘í•˜ì„¸ìš”.",
      
    }
  };
  
  // Metadata for UI: labels and flags
  const languageMeta = {
    en: { label: 'EN', name: 'English', flag: 'ğŸ‡ºğŸ‡¸' },
    ru: { label: 'RU', name: 'Ğ ÑƒÑÑĞºĞ¸Ğ¹', flag: 'ğŸ‡·ğŸ‡º' },
    ko: { label: 'KO', name: 'í•œêµ­ì–´', flag: 'ğŸ‡°ğŸ‡·' },
  };

  let activeLang = 'en';

  const vocabDeck = [
    { word: 'ì•ˆë…•í•˜ì„¸ìš”', translations: { en: 'Hello', ru: 'ĞŸÑ€Ğ¸Ğ²ĞµÑ‚', ko: 'Hello' } },
    { word: 'ê°ì‚¬í•©ë‹ˆë‹¤', translations: { en: 'Thank you', ru: 'Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾', ko: 'Thank you' } },
    { word: 'ì‚¬ë‘', translations: { en: 'Love', ru: 'Ğ›ÑĞ±Ğ¾Ğ²ÑŒ', ko: 'Love' } },
    { word: 'í•™êµ', translations: { en: 'School', ru: 'Ğ¨ĞºĞ¾Ğ»Ğ°', ko: 'School' } },
    { word: 'ìŒì‹', translations: { en: 'Food', ru: 'Ğ•Ğ´Ğ°', ko: 'Food' } },
    { word: 'ê°€ì¡±', translations: { en: 'Family', ru: 'Ğ¡ĞµĞ¼ÑŒÑ', ko: 'Family' } },
    { word: 'ì±…', translations: { en: 'Book', ru: 'ĞšĞ½Ğ¸Ğ³Ğ°', ko: 'Book' } }
  ];

  const vocabState = { index: 0, revealed: false };
  const vocabEls = {};

  function getCopy(key, lang = activeLang) {
    return translations[lang]?.[key] ?? translations.en?.[key] ?? '';
  }

  function renderVocabCard() {
    if (!vocabEls.card) return;
    const entry = vocabDeck[vocabState.index];
    const lang = activeLang;
    const translated = entry.translations[lang] ?? entry.translations.en;

    if (vocabEls.word) {
      vocabEls.word.textContent = entry.word;
    }
    if (vocabEls.translation) {
      vocabEls.translation.textContent = translated;
      const displayLang = lang === 'ru' ? 'ru' : 'en';
      vocabEls.translation.setAttribute('lang', displayLang);
    }
    vocabEls.card.classList.toggle('is-flipped', vocabState.revealed);
    vocabEls.card.setAttribute('aria-pressed', vocabState.revealed ? 'true' : 'false');
    if (vocabEls.hint) {
      vocabEls.hint.textContent = getCopy(vocabState.revealed ? 'vocab_hint_hide' : 'vocab_hint_show');
    }
    if (vocabEls.current) {
      vocabEls.current.textContent = String(vocabState.index + 1);
    }
    if (vocabEls.total) {
      vocabEls.total.textContent = String(vocabDeck.length);
    }
    updateVocabControls();
  }

  function launchConfetti() {
    if (!vocabEls.confetti) return;
    const colors = ['#6366f1', '#22d3ee', '#fb7185', '#facc15', '#34d399'];
    const pieceCount = 24;
    for (let i = 0; i < pieceCount; i += 1) {
      const piece = document.createElement('span');
      piece.className = 'confetti-piece';
      piece.style.left = `${Math.random() * 100}%`;
      piece.style.setProperty('--cx', `${Math.random() * 180 - 90}px`);
      piece.style.backgroundColor = colors[i % colors.length];
      piece.style.animationDelay = `${Math.random() * 0.35}s`;
      vocabEls.confetti.appendChild(piece);
      setTimeout(() => piece.remove(), 1700);
    }
    spawnFireworks(colors);
  }

  function spawnFireworks(colors) {
    if (!vocabEls.confetti) return;
    const bursts = 4;
    for (let i = 0; i < bursts; i += 1) {
      const firework = document.createElement('span');
      firework.className = 'firework';
      firework.style.left = `${15 + Math.random() * 70}%`;
      firework.style.top = `${20 + Math.random() * 40}%`;
      firework.style.setProperty('--fire-color', colors[(i * 2) % colors.length]);
      firework.style.animationDelay = `${i * 0.1}s`;
      vocabEls.confetti.appendChild(firework);
      setTimeout(() => firework.remove(), 1500);
    }
  }

  function updateVocabControls() {
    if (vocabEls.prev) {
      vocabEls.prev.disabled = vocabState.index === 0;
    }
    if (vocabEls.next && !vocabEls.next.dataset.locked) {
      vocabEls.next.disabled = false;
    }
  }

  function cycleVocab(direction) {
    if (!vocabDeck.length || !direction) return;
    const lastIndex = vocabDeck.length - 1;

    if (direction > 0) {
      if (vocabState.index === lastIndex) {
        if (vocabEls.next) {
          vocabEls.next.disabled = true;
          vocabEls.next.dataset.locked = 'true';
        }
        launchConfetti();
        updateVocabControls();
        setTimeout(() => {
          if (vocabEls.next) {
            vocabEls.next.disabled = false;
            delete vocabEls.next.dataset.locked;
          }
          vocabState.index = 0;
          vocabState.revealed = false;
          renderVocabCard();
        }, 1200);
        return;
      }
      vocabState.index += 1;
    } else if (direction < 0) {
      if (vocabState.index === 0) {
        return;
      }
      vocabState.index -= 1;
      if (vocabEls.next) {
        vocabEls.next.disabled = false;
        delete vocabEls.next.dataset.locked;
      }
    }

    vocabState.revealed = false;
    renderVocabCard();
  }

  function toggleVocabCard() {
    vocabState.revealed = !vocabState.revealed;
    renderVocabCard();
  }

  function initVocabDemo() {
    const card = document.querySelector('.vocab-card');
    if (!card) return;

    vocabEls.card = card;
    vocabEls.word = card.querySelector('.vocab-word');
    vocabEls.translation = card.querySelector('.vocab-translation');
    vocabEls.hint = document.querySelector('.vocab-hint');
    vocabEls.prev = document.querySelector('.vocab-nav--prev');
    vocabEls.next = document.querySelector('.vocab-nav--next');
    vocabEls.current = document.querySelector('.vocab-progress__current');
    vocabEls.total = document.querySelector('.vocab-progress__total');
    vocabEls.confetti = document.querySelector('.confetti-layer');

    if (vocabEls.total) vocabEls.total.textContent = String(vocabDeck.length);

    card.addEventListener('click', toggleVocabCard);

    vocabEls.prev?.addEventListener('click', () => cycleVocab(-1));
    vocabEls.next?.addEventListener('click', () => cycleVocab(1));

    const handleKey = (event) => {
      if (event.key === 'ArrowRight') {
        event.preventDefault();
        cycleVocab(1);
      } else if (event.key === 'ArrowLeft') {
        event.preventDefault();
        cycleVocab(-1);
      } else if (event.key === 'Enter' || event.key === ' ') {
        event.preventDefault();
        toggleVocabCard();
      }
    };

    card.addEventListener('keydown', handleKey);

    renderVocabCard();
  }

  function updateLangToggleUI(lang) {
    const meta = languageMeta[lang] || languageMeta.en;
    const toggle = document.getElementById('langToggle');
    if (!toggle) return;
    const flagEl = toggle.querySelector('.flag');
    const labelEl = toggle.querySelector('.label');
    if (flagEl) flagEl.textContent = meta.flag;
    if (labelEl) labelEl.textContent = meta.label;

    // Update options selected state
    document.querySelectorAll('.lang-option').forEach(btn => {
      const isSelected = btn.getAttribute('data-lang') === lang;
      const li = btn.closest('li');
      if (li) li.setAttribute('aria-selected', String(isSelected));
      btn.setAttribute('aria-selected', String(isSelected));
    });
  }

  function setLanguage(lang) {
    activeLang = lang;
    document.querySelectorAll("[data-i18n]").forEach(el => {
      const key = el.getAttribute("data-i18n");
      const value = translations[lang]?.[key] ?? translations.en?.[key];
      if (typeof value === 'string') {
        el.textContent = value;
      }
    });
    localStorage.setItem("lang", lang); // save choice
    // reflect in UI
    updateLangToggleUI(lang);
    // update html lang attribute
    document.documentElement.setAttribute('lang', lang);
    renderVocabCard();
  }
  
  // On load: initialize language and dropdown behavior
  document.addEventListener("DOMContentLoaded", () => {
    const savedLang = localStorage.getItem("lang") || "en";
    setLanguage(savedLang);
    initVocabDemo();

    const dropdown = document.getElementById('langDropdown');
    const toggle = document.getElementById('langToggle');
    const menu = document.getElementById('langMenu');
    const header = document.getElementById('appBar');
    const primaryNav = document.getElementById('primaryNav');
    const menuToggle = document.getElementById('menuToggle');
    const navLinks = document.getElementById('navLinks');

    if (toggle && dropdown && menu) {
      const openMenu = () => {
        dropdown.classList.add('open');
        toggle.setAttribute('aria-expanded', 'true');
        // focus first selected or first item
        const selected = menu.querySelector('.lang-option[aria-selected="true"]');
        (selected || menu.querySelector('.lang-option'))?.focus?.();
      };
      const closeMenu = () => {
        dropdown.classList.remove('open');
        toggle.setAttribute('aria-expanded', 'false');
      };

      toggle.addEventListener('click', (e) => {
        e.stopPropagation();
        const isOpen = dropdown.classList.contains('open');
        if (isOpen) closeMenu(); else openMenu();
      });

      // Option click
      menu.querySelectorAll('.lang-option').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const lang = btn.getAttribute('data-lang');
          if (lang) setLanguage(lang);
          closeMenu();
        });
      });

      // Click outside closes
      document.addEventListener('click', (e) => {
        if (!dropdown.contains(e.target)) {
          closeMenu();
        }
      });

      // Keyboard interactions
      toggle.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowDown' || e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          openMenu();
        }
      });
      menu.addEventListener('keydown', (e) => {
        const options = Array.from(menu.querySelectorAll('.lang-option'));
        const idx = options.indexOf(document.activeElement);
        if (e.key === 'Escape') { closeMenu(); toggle.focus(); }
        else if (e.key === 'ArrowDown') {
          e.preventDefault();
          const next = options[Math.min(options.length - 1, idx + 1)] || options[0];
          next.focus();
        } else if (e.key === 'ArrowUp') {
          e.preventDefault();
          const prev = options[Math.max(0, idx - 1)] || options[options.length - 1];
          prev.focus();
        } else if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          const activeBtn = document.activeElement;
          if (activeBtn && activeBtn.classList.contains('lang-option')) {
            const lang = activeBtn.getAttribute('data-lang');
            if (lang) setLanguage(lang);
            closeMenu();
            toggle.focus();
          }
        }
      });
    }

    if (header) {
      const updateHeaderState = () => {
        const shouldElevate = window.scrollY > 12;
        header.classList.toggle('is-scrolled', shouldElevate);
      };

      updateHeaderState();
      window.addEventListener('scroll', updateHeaderState, { passive: true });
    }

    if (primaryNav && menuToggle && navLinks) {
      const openNavMenu = () => {
        navLinks.classList.add('is-open');
        menuToggle.classList.add('is-open');
        menuToggle.setAttribute('aria-expanded', 'true');
      };

      const closeNavMenu = () => {
        navLinks.classList.remove('is-open');
        menuToggle.classList.remove('is-open');
        menuToggle.setAttribute('aria-expanded', 'false');
      };

      menuToggle.addEventListener('click', (e) => {
        e.stopPropagation();
        const isOpen = menuToggle.getAttribute('aria-expanded') === 'true';
        if (isOpen) closeNavMenu(); else openNavMenu();
      });

      navLinks.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => closeNavMenu());
      });

      document.addEventListener('click', (event) => {
        if (!primaryNav.contains(event.target)) {
          closeNavMenu();
        }
      });

      window.addEventListener('resize', () => {
        if (window.innerWidth > 768) {
          closeNavMenu();
        }
      });

      primaryNav.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          closeNavMenu();
          menuToggle.focus();
        }
      });
    }
  });
  
