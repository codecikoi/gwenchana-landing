const translations = {
    en: {
      nav_features: "Features",
      nav_faq: "FAQ",
      nav_download: "Download",
      nav_about: "About",
      nav_menu: "Menu",
      hero_heading: "Gwenchana",
      hero_tagline: "Not just another Korean learning app",
      hero_support: "AI tutor makes Korean grammar easier to understand",
      btn_appstore_pretitle: "Download on the",
      btn_appstore: "App Store",
      btn_googleplay_pretitle: "Get it on",
      btn_googleplay: "Google Play",
      features_title: "Why Gwenchana?",
      features_item1: "ðŸ“š Structured KIIP lessons",
      features_item2: "ðŸ¤– AI tutor explains grammar clearly",
      features_item3: "ðŸ“ Practice vocabulary, writing & reading",
      faq_title: "FAQ",
      faq_q1: "Is Gwenchana good for beginners?",
      faq_a1: "Yes, you can start with simple words and guided practice.",
      download_title: "Download Gwenchana",
      download_subtitle: "Start your free trial today.",
      about_title: "Built with learners first",
      about_body: "Gwenchana is created by KIIP alumni and Korean teachers who collaborate with AI engineers. Together we map every lesson to real cultural scenarios so you can learn language that actually lands in conversation.",
      about_card1_title: "Community wisdom",
      about_card1_body: "Weekly focus groups with expats and locals shape the curriculum.",
      about_card2_title: "AI you can trust",
      about_card2_body: "Every explanation is reviewed by certified instructors before launch."
    },
    ru: {
      nav_features: "Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸",
      nav_faq: "Ð’Ð¾Ð¿Ñ€Ð¾ÑÑ‹",
      nav_download: "Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ",
      nav_about: "Ðž Ð½Ð°Ñ",
      nav_menu: "ÐœÐµÐ½ÑŽ",
      hero_heading: "Gwenchana",
      hero_tagline: "ÐÐµ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¾Ñ‡ÐµÑ€ÐµÐ´Ð½Ð¾Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ð¸Ð·ÑƒÑ‡ÐµÐ½Ð¸Ñ ÐºÐ¾Ñ€ÐµÐ¹ÑÐºÐ¾Ð³Ð¾",
      hero_support: "Ð˜Ð˜-Ñ€ÐµÐ¿ÐµÑ‚Ð¸Ñ‚Ð¾Ñ€ Ð´ÐµÐ»Ð°ÐµÑ‚ ÐºÐ¾Ñ€ÐµÐ¹ÑÐºÑƒÑŽ Ð³Ñ€Ð°Ð¼Ð¼Ð°Ñ‚Ð¸ÐºÑƒ Ð¿Ð¾Ð½ÑÑ‚Ð½Ð¾Ð¹",
      btn_appstore_pretitle: "Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ Ð²",
      btn_appstore: "App Store",
      btn_googleplay_pretitle: "Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ Ð²",
      btn_googleplay: "Google Play",
      features_title: "ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ Gwenchana?",
      features_item1: "ðŸ“š Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ ÑƒÑ€Ð¾ÐºÐ¸ KIIP",
      features_item2: "ðŸ¤– AI-Ñ€ÐµÐ¿ÐµÑ‚Ð¸Ñ‚Ð¾Ñ€ Ð¾Ð±ÑŠÑÑÐ½ÑÐµÑ‚ Ð³Ñ€Ð°Ð¼Ð¼Ð°Ñ‚Ð¸ÐºÑƒ Ð¿Ñ€Ð¾ÑÑ‚Ð¾",
      features_item3: "ðŸ“ ÐŸÑ€Ð°ÐºÑ‚Ð¸ÐºÐ° ÑÐ»Ð¾Ð², Ð¿Ð¸ÑÑŒÐ¼Ð° Ð¸ Ñ‡Ñ‚ÐµÐ½Ð¸Ñ",
      faq_title: "Ð§Ð°ÑÑ‚Ð¾ Ð·Ð°Ð´Ð°Ð²Ð°ÐµÐ¼Ñ‹Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹",
      faq_q1: "ÐŸÐ¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ Ð»Ð¸ Gwenchana Ð´Ð»Ñ Ð½Ð¾Ð²Ð¸Ñ‡ÐºÐ¾Ð²?",
      faq_a1: "Ð”Ð°, Ð²Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ñ Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ñ… ÑÐ»Ð¾Ð² Ð¸ Ð¿Ð¾ÑˆÐ°Ð³Ð¾Ð²Ð¾Ð¹ Ð¿Ñ€Ð°ÐºÑ‚Ð¸ÐºÐ¸.",
      download_title: "Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ Gwenchana",
      download_subtitle: "ÐÐ°Ñ‡Ð½Ð¸Ñ‚Ðµ Ð±ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¾Ð±Ð½Ñ‹Ð¹ Ð¿ÐµÑ€Ð¸Ð¾Ð´ ÑƒÐ¶Ðµ ÑÐµÐ³Ð¾Ð´Ð½Ñ.",
      about_title: "Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¾ Ð´Ð»Ñ ÑƒÑ‡ÐµÐ½Ð¸ÐºÐ¾Ð²",
      about_body: "ÐšÐ¾Ð¼Ð°Ð½Ð´Ð° Gwenchana â€” Ð²Ñ‹Ð¿ÑƒÑÐºÐ½Ð¸ÐºÐ¸ KIIP, Ð¿Ñ€ÐµÐ¿Ð¾Ð´Ð°Ð²Ð°Ñ‚ÐµÐ»Ð¸ ÐºÐ¾Ñ€ÐµÐ¹ÑÐºÐ¾Ð³Ð¾ Ð¸ Ð¸Ð½Ð¶ÐµÐ½ÐµÑ€Ñ‹ Ð˜Ð˜. Ð’Ð¼ÐµÑÑ‚Ðµ Ð¼Ñ‹ Ð¿Ñ€Ð¸Ð²ÑÐ·Ñ‹Ð²Ð°ÐµÐ¼ ÑƒÑ€Ð¾ÐºÐ¸ Ðº Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¼ ÐºÑƒÐ»ÑŒÑ‚ÑƒÑ€Ð½Ñ‹Ð¼ ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ð¸ÑÐ¼, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð²Ñ‹ ÑƒÑÐ²Ð°Ð¸Ð²Ð°Ð»Ð¸ ÑÐ·Ñ‹Ðº, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð² Ð´Ð¸Ð°Ð»Ð¾Ð³Ðµ.",
      about_card1_title: "ÐœÑƒÐ´Ñ€Ð¾ÑÑ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÑÑ‚Ð²Ð°",
      about_card1_body: "Ð•Ð¶ÐµÐ½ÐµÐ´ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ ÑÐºÑÐ¿Ð°Ñ‚Ð¾Ð² Ð¸ Ð¼ÐµÑÑ‚Ð½Ñ‹Ñ… Ð¿Ð¾Ð¼Ð¾Ð³Ð°ÑŽÑ‚ Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ñƒ.",
      about_card2_title: "ÐÐ°Ð´Ñ‘Ð¶Ð½Ñ‹Ð¹ Ð˜Ð˜",
      about_card2_body: "ÐšÐ°Ð¶Ð´Ð¾Ðµ Ð¾Ð±ÑŠÑÑÐ½ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸Ñ†Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð¿Ñ€ÐµÐ¿Ð¾Ð´Ð°Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¿ÐµÑ€ÐµÐ´ Ñ€ÐµÐ»Ð¸Ð·Ð¾Ð¼."
    },
    ko: {
      nav_features: "ê¸°ëŠ¥",
      nav_faq: "ìžì£¼ ë¬»ëŠ” ì§ˆë¬¸",
      nav_download: "ë‹¤ìš´ë¡œë“œ",
      nav_about: "ì†Œê°œ",
      nav_menu: "ë©”ë‰´",
      hero_heading: "Gwenchana",
      hero_tagline: "ê·¸ì € ê·¸ëŸ° í•œêµ­ì–´ í•™ìŠµ ì•±ì´ ì•„ë‹ˆì—ìš”",
      hero_support: "AI íŠœí„°ê°€ í•œêµ­ì–´ ë¬¸ë²•ì„ ë” ì‰½ê²Œ í’€ì–´ì¤˜ìš”",
      btn_appstore_pretitle: "App Storeì—ì„œ",
      btn_appstore: "ì•±ìŠ¤í† ì–´",
      btn_googleplay_pretitle: "Google Playì—ì„œ",
      btn_googleplay: "êµ¬ê¸€ í”Œë ˆì´",
      features_title: "ì™œ Gwenchana?",
      features_item1: "ðŸ“š KIIP ë‹¨ê³„ë³„ ìˆ˜ì—…",
      features_item2: "ðŸ¤– AI íŠœí„°ê°€ ë¬¸ë²•ì„ ì‰½ê²Œ ì„¤ëª…í•´ì¤ë‹ˆë‹¤",
      features_item3: "ðŸ“ ì–´íœ˜, ì“°ê¸°, ì½ê¸° ëª¨ë‘ í•œ ì•±ì—ì„œ",
      faq_title: "FAQ",
      faq_q1: "ì´ˆë³´ìžì—ê²Œë„ ì¢‹ë‚˜ìš”?",
      faq_a1: "ë„¤, ê¸°ë³¸ ë‹¨ì–´ì™€ ê°€ì´ë“œ ì—°ìŠµë¶€í„° ì‹œìž‘í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.",
      download_title: "Gwenchana ë‹¤ìš´ë¡œë“œ",
      download_subtitle: "ì˜¤ëŠ˜ ë¬´ë£Œ ì²´í—˜ì„ ì‹œìž‘í•˜ì„¸ìš”.",
      about_title: "í•™ìŠµìžë¥¼ ë¨¼ì € ìƒê°í•©ë‹ˆë‹¤",
      about_body: "GwenchanaëŠ” KIIP ì¡¸ì—…ìƒê³¼ í•œêµ­ì–´ ì„ ìƒë‹˜, AI ì—”ì§€ë‹ˆì–´ê°€ í•¨ê»˜ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. ëª¨ë“  ë ˆìŠ¨ì„ ì‹¤ì œ ë¬¸í™” ìƒí™©ì— ë§žì¶° ì„¤ê³„í•´ ëŒ€í™”ì—ì„œ í†µí•˜ëŠ” í‘œí˜„ì„ ë°°ìš¸ ìˆ˜ ìžˆê²Œ í•´ìš”.",
      about_card1_title: "ì»¤ë®¤ë‹ˆí‹° ì¸ì‚¬ì´íŠ¸",
      about_card1_body: "ì£¼ê°„ í¬ì»¤ìŠ¤ ê·¸ë£¹ì—ì„œ ì™¸êµ­ì¸ê³¼ í˜„ì§€ì¸ì´ ì»¤ë¦¬í˜ëŸ¼ì„ í•¨ê»˜ ë‹¤ë“¬ìŠµë‹ˆë‹¤.",
      about_card2_title: "ì‹ ë¢°í•  ìˆ˜ ìžˆëŠ” AI",
      about_card2_body: "ëª¨ë“  ì„¤ëª…ì€ ì¶œì‹œ ì „ì— ê³µì¸ ê°•ì‚¬ê°€ ê²€ìˆ˜í•©ë‹ˆë‹¤."
    }
  };
  
  // Metadata for UI: labels and flags
  const languageMeta = {
    en: { label: 'EN', name: 'English', flag: 'ðŸ‡ºðŸ‡¸' },
    ru: { label: 'RU', name: 'Ð ÑƒÑÑÐºÐ¸Ð¹', flag: 'ðŸ‡·ðŸ‡º' },
    ko: { label: 'KO', name: 'í•œêµ­ì–´', flag: 'ðŸ‡°ðŸ‡·' },
  };

  function updateLangToggleUI(lang) {
    const meta = languageMeta[lang] || languageMeta.en;
    const toggle = document.getElementById('langToggle');
    if (!toggle) return;
    const flagEl = toggle.querySelector('.flag');
    const labelEl = toggle.querySelector('.label');
    if (flagEl) flagEl.textContent = meta.flag;
    if (labelEl) labelEl.textContent = meta.label;

    // Update options selected state
    document.querySelectorAll('.lang-option').forEach(btn => {
      const isSelected = btn.getAttribute('data-lang') === lang;
      const li = btn.closest('li');
      if (li) li.setAttribute('aria-selected', String(isSelected));
      btn.setAttribute('aria-selected', String(isSelected));
    });
  }

  function setLanguage(lang) {
    document.querySelectorAll("[data-i18n]").forEach(el => {
      const key = el.getAttribute("data-i18n");
      const value = translations[lang]?.[key] ?? translations.en?.[key];
      if (typeof value === 'string') {
        el.textContent = value;
      }
    });
    localStorage.setItem("lang", lang); // save choice
    // reflect in UI
    updateLangToggleUI(lang);
    // update html lang attribute
    document.documentElement.setAttribute('lang', lang);
  }
  
  // On load: initialize language and dropdown behavior
  document.addEventListener("DOMContentLoaded", () => {
    const savedLang = localStorage.getItem("lang") || "en";
    setLanguage(savedLang);

    const dropdown = document.getElementById('langDropdown');
    const toggle = document.getElementById('langToggle');
    const menu = document.getElementById('langMenu');
    const header = document.getElementById('appBar');
    const primaryNav = document.getElementById('primaryNav');
    const menuToggle = document.getElementById('menuToggle');
    const navLinks = document.getElementById('navLinks');

    if (toggle && dropdown && menu) {
      const openMenu = () => {
        dropdown.classList.add('open');
        toggle.setAttribute('aria-expanded', 'true');
        // focus first selected or first item
        const selected = menu.querySelector('.lang-option[aria-selected="true"]');
        (selected || menu.querySelector('.lang-option'))?.focus?.();
      };
      const closeMenu = () => {
        dropdown.classList.remove('open');
        toggle.setAttribute('aria-expanded', 'false');
      };

      toggle.addEventListener('click', (e) => {
        e.stopPropagation();
        const isOpen = dropdown.classList.contains('open');
        if (isOpen) closeMenu(); else openMenu();
      });

      // Option click
      menu.querySelectorAll('.lang-option').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const lang = btn.getAttribute('data-lang');
          if (lang) setLanguage(lang);
          closeMenu();
        });
      });

      // Click outside closes
      document.addEventListener('click', (e) => {
        if (!dropdown.contains(e.target)) {
          closeMenu();
        }
      });

      // Keyboard interactions
      toggle.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowDown' || e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          openMenu();
        }
      });
      menu.addEventListener('keydown', (e) => {
        const options = Array.from(menu.querySelectorAll('.lang-option'));
        const idx = options.indexOf(document.activeElement);
        if (e.key === 'Escape') { closeMenu(); toggle.focus(); }
        else if (e.key === 'ArrowDown') {
          e.preventDefault();
          const next = options[Math.min(options.length - 1, idx + 1)] || options[0];
          next.focus();
        } else if (e.key === 'ArrowUp') {
          e.preventDefault();
          const prev = options[Math.max(0, idx - 1)] || options[options.length - 1];
          prev.focus();
        } else if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          const activeBtn = document.activeElement;
          if (activeBtn && activeBtn.classList.contains('lang-option')) {
            const lang = activeBtn.getAttribute('data-lang');
            if (lang) setLanguage(lang);
            closeMenu();
            toggle.focus();
          }
        }
      });
    }

    if (header) {
      const updateHeaderState = () => {
        const shouldElevate = window.scrollY > 12;
        header.classList.toggle('is-scrolled', shouldElevate);
      };

      updateHeaderState();
      window.addEventListener('scroll', updateHeaderState, { passive: true });
    }

    if (primaryNav && menuToggle && navLinks) {
      const openNavMenu = () => {
        navLinks.classList.add('is-open');
        menuToggle.classList.add('is-open');
        menuToggle.setAttribute('aria-expanded', 'true');
      };

      const closeNavMenu = () => {
        navLinks.classList.remove('is-open');
        menuToggle.classList.remove('is-open');
        menuToggle.setAttribute('aria-expanded', 'false');
      };

      menuToggle.addEventListener('click', (e) => {
        e.stopPropagation();
        const isOpen = menuToggle.getAttribute('aria-expanded') === 'true';
        if (isOpen) closeNavMenu(); else openNavMenu();
      });

      navLinks.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => closeNavMenu());
      });

      document.addEventListener('click', (event) => {
        if (!primaryNav.contains(event.target)) {
          closeNavMenu();
        }
      });

      window.addEventListener('resize', () => {
        if (window.innerWidth > 768) {
          closeNavMenu();
        }
      });

      primaryNav.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          closeNavMenu();
          menuToggle.focus();
        }
      });
    }
  });
  
